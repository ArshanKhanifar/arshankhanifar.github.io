(this.webpackJsonpnetwork_performance=this.webpackJsonpnetwork_performance||[]).push([[0],{26:function(t,e,a){t.exports=a(40)},31:function(t,e,a){},39:function(t,e,a){},40:function(t,e,a){"use strict";a.r(e);var n=a(0),r=a.n(n),s=a(21),o=a.n(s);a(31),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(32);var i=a(7),c=a(6),l=a(8),u=a(9),h=a(12),d=a(17),p=a(15),m=(n.Component,a(2)),f=a.n(m),_=a(10),v=(n.Component,n.Component,a(24)),y=a.n(v),g=(a(39),n.Component,a(11)),b=a(14),x=a(13),k=a.n(x),w=a(18),E=a.n(w),O=(n.Component,a(25)),j=["#0d233a","#2f7ed8","#8bbc21","#910000","#1aadce","#492970","#f28f43","#77a1e5","#c42525","#a6c96a"],C=function(t){Object(u.a)(a,t);var e=Object(l.a)(a);function a(t){var n;return Object(i.a)(this,a),(n=e.call(this,t)).chart_options={chart:{zoomType:"x",animation:{duration:100}},title:{text:"Latency"},subtitle:{text:void 0===document.ontouchstart?"Click and drag in the plot area to zoom in":"Pinch the chart to zoom in"},xAxis:{type:"datetime"},yAxis:{title:{text:"Ping(ms)"},gridLineWidth:0},legend:{enabled:!1},plotOptions:{area:{marker:{radius:2},lineWidth:1,states:{hover:{lineWidth:1}},threshold:null}},series:[]},n.chartComponent=r.a.createRef(),n.total_points=0,n.stopped=!1,n}return Object(c.a)(a,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(E.a,{ref:this.chartComponent,highcharts:k.a,options:this.chart_options}),r.a.createElement("br",null))}},{key:"add_point",value:function(){this.chartComponent.current.chart.series[0].addPoint([Date.now(),.75+.25*Math.random()])}},{key:"componentDidUpdate",value:function(t,e,a){var n=this.chartComponent.current.chart;if(t.data&&this.total_points!==t.data.length){var r=t.data.slice(-1).pop();if(r){var s=0===r.id||r.id<0,o=Date.now();(n.series.length===r.id||r.id<0&&!this.stopped)&&(this.add_the_same_point_to_last_series(o,r.latency),n.addSeries({type:"area",name:"latency",data:[],color:s?"rgb(120,120,120)":j[r.id]}),r.id<0&&(this.stopped=!0)),this.total_points+=1,console.log("last_point.id",r.id),n.series[n.series.length-1].addPoint([o,r.latency])}}}},{key:"add_the_same_point_to_last_series",value:function(t,e){var a=this.chartComponent.current.chart;0!==a.series.length&&a.series[a.series.length-1].addPoint([t,e])}},{key:"loadSampleData",value:function(){var t=this;this.chartComponent.current.chart;fetch("https://cdn.jsdelivr.net/gh/highcharts/highcharts@v7.0.0/samples/data/usdeur.json").then((function(t){return t.json()})).then((function(e){t.chart.series[0].setData(e),t.chart.redraw()}))}},{key:"componentDidMount",value:function(){}}]),a}(n.Component),D=a(20),S=function(t){Object(u.a)(a,t);var e=Object(l.a)(a);function a(t){var n;return Object(i.a)(this,a),(n=e.call(this,t)).chart_options={chart:{type:"scatter",height:150},tooltip:{headerFormat:"",pointFormat:"{series.name}: <b>{point.x}</b><br/>"},xAxis:{tickInterval:5,categories:[]},title:{floating:!0,text:""},yAxis:{width:0,min:.7,max:1.8,gridLineWidth:0,tickAmount:1,title:{reserveSpace:!1,text:"Download Speed",rotation:0,x:40,y:-15},labels:{enabled:!1}},legend:{enabled:!1},plotOptions:{series:{stacking:"normal"}},series:[{name:"Download Speed",data:[],color:"red"}]},n.chartComponent=r.a.createRef(),n.chart_options.series[0].color=j[n.props.color_id],n}return Object(c.a)(a,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(D.a,null,r.a.createElement(D.a.Body,null,r.a.createElement(D.a.Title,null,this.props.title),r.a.createElement(E.a,{ref:this.chartComponent,highcharts:k.a,options:this.chart_options}))))}},{key:"add_point",value:function(){this.chartComponent.current.chart.series[0].addPoint([Date.now(),.75+.25*Math.random()])}},{key:"componentDidUpdate",value:function(t,e,a){if(t.data){var n=t.data.slice(-1).pop();if(n){var r=this.chartComponent.current.chart;r.series[0].data.length!==t.data.length&&r.series[0].addPoint([parseFloat(n.rate.toFixed(2)),1])}}}},{key:"componentDidMount",value:function(){}}]),a}(n.Component),P="down";function M(t){return new Promise((function(e){setTimeout((function(){e()}),t)}))}var B=function(t){Object(u.a)(a,t);var e=Object(l.a)(a);function a(t){var n;return Object(i.a)(this,a),(n=e.call(this,t)).state={started:!1,paused:!0,next_test:0,download_measurements:{},data:[],latency_data:[]},n.ping_timer=null,n.populate_tests(),n.reset_abort_controller(),console.log(k.a),n}return Object(c.a)(a,[{key:"reset_abort_controller",value:function(){this.controller=new AbortController}},{key:"render",value:function(){var t=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(h.a,{bg:"light"},r.a.createElement(h.a.Brand,{href:"#"},"KNP")),r.a.createElement(d.a,null,r.a.createElement(p.a,null,r.a.createElement(g.a,{lg:12},r.a.createElement("h1",null,"The Khanifar Bufferbloat Test"),r.a.createElement("p",null,"Best buffer bloat test in the history of mankind, ever\u2122")),r.a.createElement(g.a,{lg:12},r.a.createElement(C,{data:this.state.latency_data})),r.a.createElement(g.a,{lg:12},r.a.createElement(b.a,{onClick:this.test_control.bind(this)},this.state.started?this.state.paused?"Continue":"Pause":"Start")," "," ",r.a.createElement(b.a,{onClick:this.restart_tests.bind(this)},"Restart Test")),r.a.createElement(g.a,{xs:12,md:6},r.a.createElement("span",null,r.a.createElement("strong",null,"Download"))),r.a.createElement(g.a,{xs:12,md:6},r.a.createElement("span",null,r.a.createElement("strong",null,"Upload"))),r.a.createElement(g.a,{xs:6,md:4},r.a.createElement("span",null,r.a.createElement("strong",null,"latency:")," ",this.state.latest_measurement),r.a.createElement("br",null),r.a.createElement("span",null,r.a.createElement("strong",null,"bw:")," ",this.state.latest_bw_measurement,"Mbps"))),r.a.createElement(p.a,null,r.a.createElement(g.a,{xs:12,md:6},r.a.createElement("span",null,r.a.createElement("strong",null,"Download Measurements")),Object.keys(this.state.download_measurements).map((function(e){return r.a.createElement(S,{key:e,data:t.state.download_measurements[e],color_id:e,title:t.format_title(t.state.download_measurements[e])})}))),r.a.createElement(g.a,{xs:12,md:6},r.a.createElement("span",null,r.a.createElement("strong",null,"Upload Measurements"))))))}},{key:"format_title",value:function(t){return"".concat(t[0].title," Download: (").concat(t.length,"/").concat(t[0].num_tries,")")}},{key:"test_control",value:function(){var t=Object(_.a)(f.a.mark((function t(){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.state.started){t.next=5;break}return t.next=3,this.setState({started:!0,paused:!1});case 3:t.next=7;break;case 5:return t.next=7,this.setState({paused:!this.state.paused});case 7:if(!this.state.paused){t.next=15;break}return this.controller.abort(),this.reset_abort_controller(),t.next=12,M(1e4);case 12:this.stop_ping(),t.next=19;break;case 15:return this.state.next_test!==this.tests.length&&this.ping(200),t.next=18,M(1e4);case 18:this.run_scenarios();case 19:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"stop_ping",value:function(){clearTimeout(this.ping_timer)}},{key:"restart_tests",value:function(){this.setState({started:!1,paused:!0})}},{key:"populate_tests",value:function(){var t=0;function e(e,a,n,r){return t+=1,new Array(e).fill(0).map((function(s){return{direction:a,file_size:n,title:r,id:t,num_tries:e}}))}this.tests=[].concat(e(10,P,1024e3,"100KB")).concat(e(10,P,1<<20,"1MB")).concat(e(10,P,10485760,"10MB"))}},{key:"run_scenarios",value:function(){var t=Object(_.a)(f.a.mark((function t(){var e,a=this;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.state.next_test!==this.tests.length){t.next=4;break}return console.log("Scenarios exhausted.",this.state.data),setTimeout((function(){a.stop_ping()}),1e4),t.abrupt("return");case 4:return e=this.tests[this.state.next_test],this.state.data.push(Object(O.a)({},e)),t.next=8,this.setState({data:this.state.data});case 8:return t.prev=8,console.log("Running scenario: ".concat(this.state.next_test)),t.next=12,this.run_scenario(e);case 12:return t.next=14,this.setState({next_test:this.state.next_test+1});case 14:this.run_scenarios(),t.next=23;break;case 17:t.prev=17,t.t0=t.catch(8),console.log(t.t0),this.state.data.pop(),this.setState({data:this.state.data}),console.log("Scenario: ".concat(this.state.next_test," was canceled."));case 23:case"end":return t.stop()}}),t,this,[[8,17]])})));return function(){return t.apply(this,arguments)}}()},{key:"run_scenario",value:function(){var t=Object(_.a)(f.a.mark((function t(e){var n,r,s;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n="".concat(a.BASE_URL,"/").concat(a.DOWN_ENDPOINT),r=Date.now(),t.next=4,this.download(e.file_size,1,n);case 4:s=t.sent,this.collect_data(s,r),console.log("download was completed, rate: ".concat(s.toFixed(2),"Mbps"));case 7:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"collect_data",value:function(t,e){this.state.data[this.state.next_test].rate=t,this.state.data[this.state.next_test].time=e,this.setState({data:this.state.data}),this.organize()}},{key:"organize",value:function(){var t=this.state.data.slice(-1).pop(),e="".concat(t.id);if(t.direction===P){var a=this.state.download_measurements;e in a||(a[e]=[]),a[e].push(t)}}},{key:"download",value:function(){var t=Object(_.a)(f.a.mark((function t(e,a,n){var r,s,o,i;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this.controller.signal,s=Array(a).fill(0).map((function(t){return new Object})).map((function(t){return t.start=Date.now(),t.fetch=fetch("".concat(n,"?bytes=").concat(e),{signal:r}),t})),t.next=4,Promise.all(s.map((function(t){return t.fetch.then((function(e){return e.text().then((function(e){t.finish=Date.now()}))}))})));case 4:return o=s.map((function(t){return e/(t.finish-t.start)})),i=this.convert_to_mbps(o.reduce((function(t,e){return t+e}))),this.setState({latest_bw_measurement:i}),this.log_rate(i),t.abrupt("return",i);case 9:case"end":return t.stop()}}),t,this)})));return function(e,a,n){return t.apply(this,arguments)}}()},{key:"record_latency",value:function(){var t=Object(_.a)(f.a.mark((function t(e){var a;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.state.paused!==this.state.next_test){t.next=2;break}return t.abrupt("return");case 2:return a=this.state.data.length!==this.state.next_test,this.capture_latency_plot_data(e,a),this.capture_latency_with_download_measurement(e,a),t.next=7,this.sync_state_data();case 7:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"capture_latency_plot_data",value:function(t,e){var a=null;a=e?this.state.data[this.state.next_test].id:this.state.next_test?-1:0,this.state.latency_data.push({id:a,latency:t})}},{key:"capture_latency_with_download_measurement",value:function(t,e){e&&("latency"in this.state.data[this.state.next_test]||(this.state.data[this.state.next_test].latency=[]),this.state.data[this.state.next_test].latency.push(t))}},{key:"sync_state_data",value:function(){var t=Object(_.a)(f.a.mark((function t(){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.setState({latency_data:this.state.latency_data,data:this.state.data});case 2:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"ping",value:function(){var t=Object(_.a)(f.a.mark((function t(e){var a,n=this;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=Date.now(),fetch("https://api.github.com/users/arshankhanifar").then((function(t){return t.json()})).then(function(){var t=Object(_.a)(f.a.mark((function t(e){var r,s;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),s=r-a,console.log("latency",s),n.setState({latest_measurement:s}),t.next=6,n.record_latency(s);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),this.ping_timer=setTimeout((function(){return n.ping(e)}),e);case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){this.setState({latest_measurement:0,latest_bw_measurement:0})}},{key:"convert_to_mbps",value:function(t){return 1e3*t/(1<<20)*8}},{key:"log_rate",value:function(t){}}],[{key:"CONFIG",get:function(){return"cloudflare"}},{key:"BASE_URL",get:function(){return"arshan"===this.CONFIG?"https://worker.arshankhanifar.workers.dev":"https://speed.cloudflare.com"}},{key:"DOWN_ENDPOINT",get:function(){return"arshan"===this.CONFIG?"/hello/down":"__down"}}]),a}(n.Component);n.Component;o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(B,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[26,1,2]]]);
//# sourceMappingURL=main.1d1f29e8.chunk.js.map